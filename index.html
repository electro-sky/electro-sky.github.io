<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electro: Energy-Efficient Compound AI Systems</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard {
            padding: 30px;
        }

        .stacked-table-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
            margin-bottom: 30px;
        }

        .stacked-table-section:hover {
            transform: translateY(-5px);
        }

        .section-header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
            padding: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
        }

        .table-container {
            overflow-x: auto;
            max-height: 700px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        th, td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }

        th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            position: sticky;
            top: 0;
            cursor: pointer;
            user-select: none;
        }

        th:first-child {
            position: sticky;
            left: 0;
            z-index: 20;
        }

        th:nth-child(2) {
            position: sticky;
            left: 120px;
            z-index: 20;
        }

        th:nth-child(3) {
            position: sticky;
            left: 240px;
            z-index: 20;
        }

        th:hover {
            background: #edf2f7;
        }

        tr:hover td {
            background: #f7fafc !important;
        }

        .model-label {
            font-weight: 700;
            text-align: left !important;
            background: #fafafa;
            border-right: 2px solid #e2e8f0;
            min-width: 120px;
            position: sticky;
            left: 0;
            z-index: 10;
        }

        .llama8b-label {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .image.pngb-label {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
        }

        .config-cell {
            font-weight: 600;
            text-align: left !important;
            background: #fafafa;
            position: sticky;
            left: 120px;
            z-index: 10;
            min-width: 120px;
        }

        .topk-cell {
            font-weight: 600;
            text-align: center !important;
            background: #fafafa;
            position: sticky;
            left: 240px;
            z-index: 10;
            min-width: 60px;
        }

        .value-cell {
            font-weight: 500;
        }

        .best-value {
            background: #fff9c4 !important;
            color: #333;
            font-weight: 700;
        }

        .summary-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .summary-header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #4a5568;
            padding: 15px 20px;
            margin: -20px -20px 20px -20px;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
        }

        .summary-grid {
            /* Grid layout now handled inline */
        }

        .summary-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .summary-card h3 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3748;
        }

        .summary-label {
            font-size: 0.9rem;
            color: #718096;
            margin-top: 5px;
        }

        .positive-delta {
            color: #10b981;
            font-weight: 600;
        }

        .negative-delta {
            color: #ef4444;
            font-weight: 600;
        }

        .zero-delta {
            color: #6b7280;
        }

        .sort-indicator {
            margin-left: 5px;
            opacity: 0.6;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #4a5568;
        }

        .filter-controls {
            background: #f8fafc;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 0.9rem;
            min-width: 120px;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 2px rgba(79, 172, 254, 0.2);
        }

        .clear-filters {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s ease;
        }

        .clear-filters:hover {
            transform: translateY(-2px);
        }

        .filter-summary {
            background: #e0f2fe;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #0369a1;
            margin-top: 10px;
        }

        .tab-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .tab-nav {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button:hover {
            background: #f1f5f9;
            color: #475569;
        }

        .tab-button.active {
            color: #4facfe;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }



        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .dashboard {
                padding: 15px;
            }
            
            table {
                font-size: 10px;
            }
            
            th, td {
                padding: 4px 2px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° Electro: Energy-Efficient Compound AI Systems
            </h1>
            <p>RAG Benchmark Comparison across FinanceBench, Frames, and TriviaQA</p>
        </div>

        <div class="dashboard">
            <!-- Tab Navigation -->
            <div class="tab-container">
                <div class="tab-nav">
                    <button class="tab-button active" onclick="switchTab('financebench')">üí∞ FinanceBench</button>
                    <button class="tab-button" onclick="switchTab('frames')">üñºÔ∏è Frames</button>
                    <button class="tab-button" onclick="switchTab('triviaqa')">üìù TriviaQA</button>
                </div>
            </div>

            <!-- Tab Content -->
            <div id="financebench" class="tab-content active">
                <!-- Filter Controls -->
                <div class="filter-controls">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Model:</label>
                            <select id="modelFilter">
                                <option value="">All Models</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Embedding:</label>
                            <select id="embeddingFilter">
                                <option value="">All Embeddings</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Top K:</label>
                            <select id="topKFilter">
                                <option value="">All Top K</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Generation Model:</label>
                            <select id="generationModelFilter">
                                <option value="">All Gen Models</option>
                            </select>
                        </div>
                        <button class="clear-filters" onclick="clearAllFilters()">Clear All Filters</button>
                    </div>
                    <div id="filterSummary" class="filter-summary" style="display: none;">
                        Showing filtered results
                    </div>
                </div>

                <!-- Main Comparison Table -->
                <div class="stacked-table-section">
                    <div class="section-header">
                        üîç Detailed Performance Comparison - FinanceBench
                    </div>
                    <div class="table-container">
                        <div id="tableLoading" class="loading">Loading benchmark data...</div>
                        <table id="comparisonTable" style="display: none;">
                            <thead id="tableHead">
                            </thead>
                            <tbody id="tableBody">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Best Configurations Table -->
                <div class="summary-section">
                    <div class="summary-header">
                        üèÜ Best Configurations by Metric - FinanceBench
                    </div>
                    <div id="bestConfigsContainer">
                        <div class="loading">Loading best configurations...</div>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div class="summary-section">
                    <div class="summary-header">
                        üìä Performance Summary - FinanceBench
                    </div>
                    <div id="summaryStats" class="summary-grid">
                        <div class="loading">Loading summary statistics...</div>
                    </div>
                </div>
            </div>

            <div id="frames" class="tab-content">
                <!-- Filter Controls -->
                <div class="filter-controls">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Model:</label>
                            <select id="modelFilterFrames">
                                <option value="">All Models</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Embedding:</label>
                            <select id="embeddingFilterFrames">
                                <option value="">All Embeddings</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Top K:</label>
                            <select id="topKFilterFrames">
                                <option value="">All Top K</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Arrival Rate:</label>
                            <select id="arrivalRateFilterFrames">
                                <option value="">All Rates</option>
                            </select>
                        </div>
                        <button class="clear-filters" onclick="clearAllFiltersFrames()">Clear All Filters</button>
                    </div>
                    <div id="filterSummaryFrames" class="filter-summary" style="display: none;">
                        Showing filtered results
                    </div>
                </div>

                <!-- Main Comparison Table -->
                <div class="stacked-table-section">
                    <div class="section-header">
                        üîç Detailed Performance Comparison - Frames
                    </div>
                    <div class="table-container">
                        <div id="tableLoadingFrames" class="loading">Loading benchmark data...</div>
                        <table id="comparisonTableFrames" style="display: none;">
                            <thead id="tableHeadFrames">
                            </thead>
                            <tbody id="tableBodyFrames">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Best Configurations Table -->
                <div class="summary-section">
                    <div class="summary-header">
                        üèÜ Best Configurations by Metric - Frames
                    </div>
                    <div id="bestConfigsContainerFrames">
                        <div class="loading">Loading best configurations...</div>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div class="summary-section">
                    <div class="summary-header">
                        üìä Performance Summary - Frames
                    </div>
                    <div id="summaryStatsFrames" class="summary-grid">
                        <div class="loading">Loading summary statistics...</div>
                    </div>
                </div>
            </div>

            <div id="triviaqa" class="tab-content">
                <!-- Filter Controls -->
                <div class="filter-controls">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Model:</label>
                            <select id="modelFilterTriviaQA">
                                <option value="">All Models</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Embedding:</label>
                            <select id="embeddingFilterTriviaQA">
                                <option value="">All Embeddings</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Top K:</label>
                            <select id="topKFilterTriviaQA">
                                <option value="">All Top K</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Arrival Rate:</label>
                            <select id="arrivalRateFilterTriviaQA">
                                <option value="">All Rates</option>
                            </select>
                        </div>
                        <button class="clear-filters" onclick="clearAllFiltersTriviaQA()">Clear All Filters</button>
                    </div>
                    <div id="filterSummaryTriviaQA" class="filter-summary" style="display: none;">
                        Showing filtered results
                    </div>
                </div>

                <!-- Main Comparison Table -->
                <div class="stacked-table-section">
                    <div class="section-header">
                        üîç Detailed Performance Comparison - TriviaQA
                    </div>
                    <div class="table-container">
                        <div id="tableLoadingTriviaQA" class="loading">Loading benchmark data...</div>
                        <table id="comparisonTableTriviaQA" style="display: none;">
                            <thead id="tableHeadTriviaQA">
                            </thead>
                            <tbody id="tableBodyTriviaQA">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Best Configurations Table -->
                <div class="summary-section">
                    <div class="summary-header">
                        üèÜ Best Configurations by Metric - TriviaQA
                    </div>
                    <div id="bestConfigsContainerTriviaQA">
                        <div class="loading">Loading best configurations...</div>
                    </div>
                </div>

                <!-- Summary Statistics -->
                <div class="summary-section">
                    <div class="summary-header">
                        üìä Performance Summary - TriviaQA
                    </div>
                    <div id="summaryStatsTriviaQA" class="summary-grid">
                        <div class="loading">Loading summary statistics...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let datasets = {
            financebench: { llama8bData: [], llama70bData: [], headers: [], combinedData: [], originalCombinedData: [] },
            frames: { allData: [], headers: [], combinedData: [], originalCombinedData: [] },
            triviaqa: { allData: [], headers: [], combinedData: [], originalCombinedData: [] }
        };
        
        let currentTab = 'financebench';
        let currentFilters = {
            financebench: { model: '', embedding: '', topK: '', generationModel: '' },
            frames: { model: '', embedding: '', topK: '', arrivalRate: '' },
            triviaqa: { model: '', embedding: '', topK: '', arrivalRate: '' }
        };

        // Key metrics to focus on
        const keyMetrics = [
            'Avg. RAG Accuracy',
            'Retrieved Doc. Recall@K',
            'Avg. Queue Latency (s)',
            'Avg. Gen. Latency (s)',
            'P99 Latency (s)',
            'Throughput (q/s)',
            'Total Avg. Energy per Query (J)'
        ];

        // Function to parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line) {
                    const values = line.split(',').map(v => v.trim());
                    data.push(values);
                }
            }
            
            return { headers, data };
        }

        // Function to create configuration label
        function createConfigLabel(row, headers) {
            const embeddingModelIndex = headers.indexOf('Embedding Model');
            const topKIndex = headers.indexOf('Top K');
            
            if (embeddingModelIndex === -1) {
                console.error('Embedding Model column not found in headers:', headers);
                return 'Unknown';
            }
            
            const embeddingModel = row[embeddingModelIndex];
            const topK = topKIndex !== -1 ? row[topKIndex] : 'N/A';
            
            if (!embeddingModel) {
                console.error('Embedding model value is undefined for row:', row);
                return 'Unknown';
            }
            
            // Shorten embedding model names
            const shortEmbedding = embeddingModel
                .replace('intfloat/multilingual-e5-small', 'E5-Small')
                .replace('Alibaba-NLP/gte-multilingual-base', 'GTE-Multi')
                .replace('infly/inf-retriever-v1-1.5b', 'InfRetriever-1.5B')
                .replace('infly/inf-retriever-v1', 'InfRetriever-v1')
                .replace('Snowflake/snowflake-arctic-embed-s', 'Arctic-Embed-S');
            
            return `${shortEmbedding}`;
        }

        // Tab switching function
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // Load data for the selected tab if not already loaded
            if (tabName === 'financebench' && datasets.financebench.combinedData.length === 0) {
                loadFinanceBenchData();
            } else if (tabName === 'frames' && datasets.frames.combinedData.length === 0) {
                loadFramesData();
            } else if (tabName === 'triviaqa' && datasets.triviaqa.combinedData.length === 0) {
                loadTriviaQAData();
            }
        }

        // Function to load FinanceBench data
        async function loadFinanceBenchData() {
            try {
                console.log('Loading FinanceBench data...');
                
                const response = await fetch('financebench_data.csv');
                if (!response.ok) {
                    throw new Error(`Failed to load FinanceBench data: ${response.status} ${response.statusText}`);
                }
                const csvText = await response.text();
                const { headers, data } = parseCSV(csvText);
                
                datasets.financebench.headers = headers;
                
                // Separate 8B and 70B data
                const llama8bData = data.filter(row => row[0] === 'LLAMA8B');
                const llama70bData = data.filter(row => row[0] === 'LLAMA70B');
                
                datasets.financebench.llama8bData = llama8bData;
                datasets.financebench.llama70bData = llama70bData;
                
                // Create combined data
                const combinedData = [];
                
                llama8bData.forEach((row, index) => {
                    try {
                        const configLabel = createConfigLabel(row, headers);
                        const topKIndex = headers.indexOf('Top K');
                        const topK = topKIndex !== -1 ? row[topKIndex] : 'N/A';
                        const combinedRow = ['üê™ LLaMA 8B', configLabel, topK, ...row];
                        combinedData.push(combinedRow);
                    } catch (error) {
                        console.error(`Error processing 8B row ${index}:`, error, row);
                    }
                });
                
                llama70bData.forEach((row, index) => {
                    try {
                        const configLabel = createConfigLabel(row, headers);
                        const topKIndex = headers.indexOf('Top K');
                        const topK = topKIndex !== -1 ? row[topKIndex] : 'N/A';
                        const combinedRow = ['üê™üê™ LLaMA 70B', configLabel, topK, ...row];
                        combinedData.push(combinedRow);
                    } catch (error) {
                        console.error(`Error processing 70B row ${index}:`, error, row);
                    }
                });
                
                datasets.financebench.combinedData = combinedData;
                datasets.financebench.originalCombinedData = [...combinedData];
                
                // Populate filter options and render
                populateFilters();
                renderTable();
                generateSummaryStats();
                generateBestConfigs();
                
                // Hide loading indicators
                document.getElementById('tableLoading').style.display = 'none';
                document.getElementById('comparisonTable').style.display = 'table';
                
            } catch (error) {
                console.error('Error loading FinanceBench data:', error);
                document.getElementById('tableLoading').textContent = 'Error loading data: ' + error.message;
            }
        }

        // Function to load Frames data
        async function loadFramesData() {
            try {
                console.log('Loading Frames data...');
                
                const response = await fetch('frames_data.csv');
                if (!response.ok) {
                    throw new Error(`Failed to load Frames data: ${response.status} ${response.statusText}`);
                }
                const csvText = await response.text();
                const { headers, data } = parseCSV(csvText);
                
                datasets.frames.headers = headers;
                datasets.frames.allData = data;
                
                // Create combined data
                const combinedData = [];
                
                data.forEach((row, index) => {
                    try {
                        const configLabel = createConfigLabel(row, headers);
                        const topKIndex = headers.indexOf('Top K');
                        const topK = topKIndex !== -1 ? row[topKIndex] : 'N/A';
                        const modelLabel = row[0] === 'LLAMA8B' ? 'üê™ LLaMA 8B' : 'üê™üê™ LLaMA 70B';
                        const combinedRow = [modelLabel, configLabel, topK, ...row];
                        combinedData.push(combinedRow);
                    } catch (error) {
                        console.error(`Error processing Frames row ${index}:`, error, row);
                    }
                });
                
                datasets.frames.combinedData = combinedData;
                datasets.frames.originalCombinedData = [...combinedData];
                
                // Populate filter options and render for Frames
                populateFiltersFrames();
                renderTableFrames();
                generateSummaryStatsFrames();
                generateBestConfigsFrames();
                
                // Hide loading indicators
                document.getElementById('tableLoadingFrames').style.display = 'none';
                document.getElementById('comparisonTableFrames').style.display = 'table';
                
            } catch (error) {
                console.error('Error loading Frames data:', error);
                document.getElementById('tableLoadingFrames').textContent = 'Error loading data: ' + error.message;
            }
        }

        // Function to load TriviaQA data
        async function loadTriviaQAData() {
            try {
                console.log('Loading TriviaQA data...');
                
                const response = await fetch('triviaqa_data.csv');
                if (!response.ok) {
                    throw new Error(`Failed to load TriviaQA data: ${response.status} ${response.statusText}`);
                }
                const csvText = await response.text();
                const { headers, data } = parseCSV(csvText);
                
                datasets.triviaqa.headers = headers;
                datasets.triviaqa.allData = data;
                
                // Create combined data
                const combinedData = [];
                
                data.forEach((row, index) => {
                    try {
                        const configLabel = createConfigLabel(row, headers);
                        const topKIndex = headers.indexOf('Top K');
                        const topK = topKIndex !== -1 ? row[topKIndex] : 'N/A';
                        const modelLabel = row[0] === 'LLAMA8B' ? 'üê™ LLaMA 8B' : 'üê™üê™ LLaMA 70B';
                        const combinedRow = [modelLabel, configLabel, topK, ...row];
                        combinedData.push(combinedRow);
                    } catch (error) {
                        console.error(`Error processing TriviaQA row ${index}:`, error, row);
                    }
                });
                
                datasets.triviaqa.combinedData = combinedData;
                datasets.triviaqa.originalCombinedData = [...combinedData];
                
                // Populate filter options and render for TriviaQA
                populateFiltersTriviaQA();
                renderTableTriviaQA();
                generateSummaryStatsTriviaQA();
                generateBestConfigsTriviaQA();
                
                // Hide loading indicators
                document.getElementById('tableLoadingTriviaQA').style.display = 'none';
                document.getElementById('comparisonTableTriviaQA').style.display = 'table';
                
            } catch (error) {
                console.error('Error loading TriviaQA data:', error);
                document.getElementById('tableLoadingTriviaQA').textContent = 'Error loading data: ' + error.message;
            }
        }

        function renderTable() {
            const table = document.getElementById('comparisonTable');
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');
            
            // Clear existing content
            thead.innerHTML = '';
            tbody.innerHTML = '';
            
            // Create header row
            const headerRow = document.createElement('tr');
            const combinedHeaders = ['Model', 'Embedding', ...datasets.financebench.headers];
            
            combinedHeaders.forEach((header, index) => {
                const th = document.createElement('th');
                th.onclick = () => sortTable(index);
                th.innerHTML = `${header} <span class="sort-indicator">‚Üï</span>`;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            // Create data rows
            datasets.financebench.combinedData.forEach(row => {
                const tr = document.createElement('tr');
                
                // Apply background color based on model type
                if (row[0] && row[0].includes('8B')) {
                    tr.style.backgroundColor = '#fdf2f8'; // Light pink for LLaMA 8B
                } else if (row[0] && row[0].includes('70B')) {
                    tr.style.backgroundColor = '#f0fdfa'; // Light teal for LLaMA 70B
                }
                
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    
                    if (index === 0) {
                        // Model label
                        td.className = 'model-label';
                        if (cell && cell.includes('8B')) {
                            td.className += ' llama8b-label';
                        } else if (cell && cell.includes('70B')) {
                            td.className += ' llama70b-label';
                        }
                        td.textContent = cell || '';
                    } else if (index === 1) {
                        // Config label
                        td.className = 'config-cell';
                        td.textContent = cell || '';
                    } else if (index === 2) {
                        // Top K
                        td.className = 'topk-cell';
                        td.textContent = cell || '';
                    } else {
                        // Value cell
                        td.className = 'value-cell';
                        const headerName = combinedHeaders[index];
                        
                        // Format numeric values
                        if (cell && !isNaN(parseFloat(cell))) {
                            const value = parseFloat(cell);
                            if (headerName && headerName.includes('Accuracy') || headerName && headerName.includes('Recall')) {
                                td.textContent = (value * 100).toFixed(1) + '%';
                            } else if (headerName && headerName.includes('Latency') || headerName && headerName.includes('Energy')) {
                                td.textContent = value.toFixed(3);
                            } else {
                                td.textContent = value.toFixed(2);
                            }
                        } else {
                            td.textContent = cell || '';
                        }
                        
                        // No highlighting needed
                    }
                    
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });
        }

        function shouldHighlight(cellValue, headerName, isHigherBetter) {
            if (!cellValue || isNaN(parseFloat(cellValue))) return false;
            
            const value = parseFloat(cellValue);
            const values = [];
            
            // Collect all values for this metric
            combinedData.forEach(row => {
                const headerIndex = headers.indexOf(headerName);
                if (headerIndex !== -1) {
                    const val = parseFloat(row[headerIndex + 3]);
                    if (!isNaN(val)) values.push(val);
                }
            });
            
            if (values.length === 0) return false;
            
            const bestValue = isHigherBetter ? Math.max(...values) : Math.min(...values);
            return Math.abs(value - bestValue) < 0.001; // Account for floating point precision
        }

        function sortTable(columnIndex) {
            datasets.financebench.combinedData.sort((a, b) => {
                let aVal = a[columnIndex];
                let bVal = b[columnIndex];
                
                if (typeof aVal === 'string' && !isNaN(parseFloat(aVal))) {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                }
                
                if (typeof aVal === 'number' && typeof bVal === 'number') {
                    return bVal - aVal;
                } else {
                    return aVal.toString().localeCompare(bVal.toString());
                }
            });
            
            renderTable();
        }

        function generateSummaryStats() {
            const stats = calculateSummaryStats();
            const container = document.getElementById('summaryStats');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: 200px 1fr 1fr 1fr; gap: 20px; width: 100%;">
                    <div class="summary-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; display: flex; align-items: center; justify-content: center;">
                        <h3 style="margin: 0; font-size: 1.2rem;">üê™ LLaMA 8B</h3>
                    </div>
                    <div class="summary-card">
                        <h3>üéØ Best RAG Accuracy</h3>
                        <div class="summary-value">${(stats.bestAccuracy8B * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <h3>‚ö° Lowest Latency</h3>
                        <div class="summary-value">${stats.lowestLatency8B.toFixed(3)}s</div>
                    </div>
                    <div class="summary-card">
                        <h3>üîã Lowest Energy</h3>
                        <div class="summary-value">${stats.lowestEnergy8B.toFixed(1)}J</div>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; display: flex; align-items: center; justify-content: center;">
                        <h3 style="margin: 0; font-size: 1.2rem;">üê™üê™ LLaMA 70B</h3>
                    </div>
                    <div class="summary-card">
                        <h3>üéØ Best RAG Accuracy</h3>
                        <div class="summary-value">${(stats.bestAccuracy70B * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <h3>‚ö° Lowest Latency</h3>
                        <div class="summary-value">${stats.lowestLatency70B.toFixed(3)}s</div>
                    </div>
                    <div class="summary-card">
                        <h3>üîã Lowest Energy</h3>
                        <div class="summary-value">${stats.lowestEnergy70B.toFixed(1)}J</div>
                    </div>
                </div>
            `;
        }

        function calculateSummaryStats() {
            const headers = datasets.financebench.headers;
            const accuracyIndex = headers.indexOf('Avg. RAG Accuracy');
            const latencyIndex = headers.indexOf('Avg. Gen. Latency (s)');
            const energyIndex = headers.indexOf('Total Avg. Energy per Query (J)');
            
            const stats = {
                bestAccuracy8B: 0,
                bestAccuracy70B: 0,
                lowestLatency8B: Infinity,
                lowestLatency70B: Infinity,
                lowestEnergy8B: Infinity,
                lowestEnergy70B: Infinity
            };
            
            datasets.financebench.llama8bData.forEach(row => {
                const accuracy = parseFloat(row[accuracyIndex]) || 0;
                const latency = parseFloat(row[latencyIndex]) || Infinity;
                const energy = parseFloat(row[energyIndex]) || Infinity;
                
                if (accuracy > stats.bestAccuracy8B) stats.bestAccuracy8B = accuracy;
                if (latency < stats.lowestLatency8B) stats.lowestLatency8B = latency;
                if (energy < stats.lowestEnergy8B) stats.lowestEnergy8B = energy;
            });
            
            datasets.financebench.llama70bData.forEach(row => {
                const accuracy = parseFloat(row[accuracyIndex]) || 0;
                const latency = parseFloat(row[latencyIndex]) || Infinity;
                const energy = parseFloat(row[energyIndex]) || Infinity;
                
                if (accuracy > stats.bestAccuracy70B) stats.bestAccuracy70B = accuracy;
                if (latency < stats.lowestLatency70B) stats.lowestLatency70B = latency;
                if (energy < stats.lowestEnergy70B) stats.lowestEnergy70B = energy;
            });
            
            return stats;
        }

        function generateBestConfigs() {
            const container = document.getElementById('bestConfigsContainer');
            const bestConfigs = findBestConfigurations();
            
            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f7fafc;">
                                <th style="padding: 12px; text-align: center;">Metric</th>
                                <th style="padding: 12px; text-align: center; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white;">Best LLaMA 8B</th>
                                <th style="padding: 12px; text-align: center;">Value</th>
                                <th style="padding: 12px; text-align: center; background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white;">Best LLaMA 70B</th>
                                <th style="padding: 12px; text-align: center;">Value</th>
                                <th style="padding: 12px; text-align: center;">Winner</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            Object.entries(bestConfigs).forEach(([metric, data]) => {
                const winner = data.winner === '8B' ? 'üê™ LLaMA 8B' : 'üê™üê™ LLaMA 70B';
                const winnerClass = data.winner === '8B' ? 'llama8b-label' : 'llama70b-label';
                
                html += `
                    <tr>
                        <td style="padding: 12px; font-weight: 600; text-align: center;">${metric}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9em;">${data.config8B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 600;">${data.value8B}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9em;">${data.config70B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 600;">${data.value70B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 700; border-radius: 5px;" class="${winnerClass}">${winner}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function findBestConfigurations() {
            const headers = datasets.financebench.headers;
            const metrics = [
                { name: 'RAG Accuracy', index: headers.indexOf('Avg. RAG Accuracy'), higher: true, format: (v) => (v * 100).toFixed(1) + '%' },
                { name: 'Document Recall', index: headers.indexOf('Retrieved Doc. Recall@K'), higher: true, format: (v) => (v * 100).toFixed(1) + '%' },
                { name: 'Generation Latency', index: headers.indexOf('Avg. Gen. Latency (s)'), higher: false, format: (v) => v.toFixed(3) + 's' },
                { name: 'Total Energy', index: headers.indexOf('Total Avg. Energy per Query (J)'), higher: false, format: (v) => v.toFixed(1) + 'J' },
                { name: 'Throughput', index: headers.indexOf('Throughput (q/s)'), higher: true, format: (v) => v.toFixed(2) + ' q/s' }
            ];
            
            const bestConfigs = {};
            
            metrics.forEach(metric => {
                if (metric.index === -1) return;
                
                let best8B = { value: metric.higher ? -Infinity : Infinity, config: '', row: null };
                let best70B = { value: metric.higher ? -Infinity : Infinity, config: '', row: null };
                
                datasets.financebench.llama8bData.forEach(row => {
                    const value = parseFloat(row[metric.index]);
                    if (!isNaN(value)) {
                        if ((metric.higher && value > best8B.value) || (!metric.higher && value < best8B.value)) {
                            best8B = { value, config: createConfigLabel(row, headers), row };
                        }
                    }
                });
                
                datasets.financebench.llama70bData.forEach(row => {
                    const value = parseFloat(row[metric.index]);
                    if (!isNaN(value)) {
                        if ((metric.higher && value > best70B.value) || (!metric.higher && value < best70B.value)) {
                            best70B = { value, config: createConfigLabel(row, headers), row };
                        }
                    }
                });
                
                const winner = (metric.higher ? best8B.value > best70B.value : best8B.value < best70B.value) ? '8B' : '70B';
                
                bestConfigs[metric.name] = {
                    config8B: best8B.config + ` (K=${best8B.row[headers.indexOf('Top K')]})`,
                    value8B: metric.format(best8B.value),
                    config70B: best70B.config + ` (K=${best70B.row[headers.indexOf('Top K')]})`,
                    value70B: metric.format(best70B.value),
                    winner
                };
            });
            
            return bestConfigs;
        }

        // Filter functions
        function populateFilters() {
            const originalCombinedData = datasets.financebench.originalCombinedData;
            const headers = datasets.financebench.headers;
            const modelOptions = [...new Set(originalCombinedData.map(row => row[0]))];
            const embeddingOptions = [...new Set(originalCombinedData.map(row => row[1]))];
            const topKOptions = [...new Set(originalCombinedData.map(row => row[2]))].sort((a, b) => parseInt(a) - parseInt(b));
            const generationModelIndex = headers.indexOf('Generation Model');
            const generationModelOptions = generationModelIndex !== -1 ? 
                [...new Set(originalCombinedData.map(row => row[generationModelIndex + 3]))] : [];
            
            populateSelect('modelFilter', modelOptions);
            populateSelect('embeddingFilter', embeddingOptions);
            populateSelect('topKFilter', topKOptions);
            populateSelect('generationModelFilter', generationModelOptions);
            
            // Add event listeners
            document.getElementById('modelFilter').addEventListener('change', applyFilters);
            document.getElementById('embeddingFilter').addEventListener('change', applyFilters);
            document.getElementById('topKFilter').addEventListener('change', applyFilters);
            document.getElementById('generationModelFilter').addEventListener('change', applyFilters);
        }
        
        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            options.forEach(option => {
                if (option && option.trim()) {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                }
            });
        }
        
        function applyFilters() {
            const filters = currentFilters.financebench;
            filters.model = document.getElementById('modelFilter').value;
            filters.embedding = document.getElementById('embeddingFilter').value;
            filters.topK = document.getElementById('topKFilter').value;
            filters.generationModel = document.getElementById('generationModelFilter').value;
            
            const headers = datasets.financebench.headers;
            const originalCombinedData = datasets.financebench.originalCombinedData;
            
            // Filter the data
            datasets.financebench.combinedData = originalCombinedData.filter(row => {
                const generationModelIndex = headers.indexOf('Generation Model');
                const generationModel = generationModelIndex !== -1 ? row[generationModelIndex + 3] : '';
                
                return (
                    (!filters.model || row[0] === filters.model) &&
                    (!filters.embedding || row[1] === filters.embedding) &&
                    (!filters.topK || row[2] === filters.topK) &&
                    (!filters.generationModel || generationModel === filters.generationModel)
                );
            });
            
            // Update summary
            updateFilterSummary();
            
            // Re-render table
            renderTable();
            
            // Update stats and configs with filtered data
            generateSummaryStats();
            generateBestConfigs();
        }
        
        function clearAllFilters() {
            document.getElementById('modelFilter').value = '';
            document.getElementById('embeddingFilter').value = '';
            document.getElementById('topKFilter').value = '';
            document.getElementById('generationModelFilter').value = '';
            
            currentFilters.financebench = {
                model: '',
                embedding: '',
                topK: '',
                generationModel: ''
            };
            
            datasets.financebench.combinedData = [...datasets.financebench.originalCombinedData];
            
            updateFilterSummary();
            renderTable();
            generateSummaryStats();
            generateBestConfigs();
        }
        
        function updateFilterSummary() {
            const summary = document.getElementById('filterSummary');
            const filters = currentFilters.financebench;
            const activeFilters = Object.entries(filters)
                .filter(([key, value]) => value !== '')
                .map(([key, value]) => `${key}: ${value}`);
            
            if (activeFilters.length > 0) {
                summary.style.display = 'block';
                summary.textContent = `Showing ${datasets.financebench.combinedData.length} rows filtered by: ${activeFilters.join(', ')}`;
            } else {
                summary.style.display = 'none';
            }
        }

        // Functions for Frames tab
        function populateFiltersFrames() {
            const originalCombinedData = datasets.frames.originalCombinedData;
            const headers = datasets.frames.headers;
            const modelOptions = [...new Set(originalCombinedData.map(row => row[0]))];
            const embeddingOptions = [...new Set(originalCombinedData.map(row => row[1]))];
            const topKOptions = [...new Set(originalCombinedData.map(row => row[2]))].sort((a, b) => parseInt(a) - parseInt(b));
            const arrivalRateIndex = headers.indexOf('Arrival Rate');
            const arrivalRateOptions = arrivalRateIndex !== -1 ? 
                [...new Set(originalCombinedData.map(row => row[arrivalRateIndex + 3]))].sort((a, b) => parseFloat(a) - parseFloat(b)) : [];
            
            populateSelect('modelFilterFrames', modelOptions);
            populateSelect('embeddingFilterFrames', embeddingOptions);
            populateSelect('topKFilterFrames', topKOptions);
            populateSelect('arrivalRateFilterFrames', arrivalRateOptions);
            
            // Add event listeners
            document.getElementById('modelFilterFrames').addEventListener('change', applyFiltersFrames);
            document.getElementById('embeddingFilterFrames').addEventListener('change', applyFiltersFrames);
            document.getElementById('topKFilterFrames').addEventListener('change', applyFiltersFrames);
            document.getElementById('arrivalRateFilterFrames').addEventListener('change', applyFiltersFrames);
        }

        function applyFiltersFrames() {
            const filters = currentFilters.frames;
            filters.model = document.getElementById('modelFilterFrames').value;
            filters.embedding = document.getElementById('embeddingFilterFrames').value;
            filters.topK = document.getElementById('topKFilterFrames').value;
            filters.arrivalRate = document.getElementById('arrivalRateFilterFrames').value;
            
            const headers = datasets.frames.headers;
            const originalCombinedData = datasets.frames.originalCombinedData;
            
            // Filter the data
            datasets.frames.combinedData = originalCombinedData.filter(row => {
                const arrivalRateIndex = headers.indexOf('Arrival Rate');
                const arrivalRate = arrivalRateIndex !== -1 ? row[arrivalRateIndex + 3] : '';
                
                return (
                    (!filters.model || row[0] === filters.model) &&
                    (!filters.embedding || row[1] === filters.embedding) &&
                    (!filters.topK || row[2] === filters.topK) &&
                    (!filters.arrivalRate || arrivalRate === filters.arrivalRate)
                );
            });
            
            // Update summary
            updateFilterSummaryFrames();
            
            // Re-render table
            renderTableFrames();
            
            // Update stats and configs with filtered data
            generateSummaryStatsFrames();
            generateBestConfigsFrames();
        }

        function clearAllFiltersFrames() {
            document.getElementById('modelFilterFrames').value = '';
            document.getElementById('embeddingFilterFrames').value = '';
            document.getElementById('topKFilterFrames').value = '';
            document.getElementById('arrivalRateFilterFrames').value = '';
            
            currentFilters.frames = {
                model: '',
                embedding: '',
                topK: '',
                arrivalRate: ''
            };
            
            datasets.frames.combinedData = [...datasets.frames.originalCombinedData];
            
            updateFilterSummaryFrames();
            renderTableFrames();
            generateSummaryStatsFrames();
            generateBestConfigsFrames();
        }

        function updateFilterSummaryFrames() {
            const summary = document.getElementById('filterSummaryFrames');
            const filters = currentFilters.frames;
            const activeFilters = Object.entries(filters)
                .filter(([key, value]) => value !== '')
                .map(([key, value]) => `${key}: ${value}`);
            
            if (activeFilters.length > 0) {
                summary.style.display = 'block';
                summary.textContent = `Showing ${datasets.frames.combinedData.length} rows filtered by: ${activeFilters.join(', ')}`;
            } else {
                summary.style.display = 'none';
            }
        }

        function renderTableFrames() {
            const table = document.getElementById('comparisonTableFrames');
            const thead = document.getElementById('tableHeadFrames');
            const tbody = document.getElementById('tableBodyFrames');
            
            // Clear existing content
            thead.innerHTML = '';
            tbody.innerHTML = '';
            
            // Create header row
            const headerRow = document.createElement('tr');
            const combinedHeaders = ['Model', 'Embedding', 'Top K', ...datasets.frames.headers];
            
            combinedHeaders.forEach((header, index) => {
                const th = document.createElement('th');
                th.onclick = () => sortTableFrames(index);
                th.innerHTML = `${header} <span class="sort-indicator">‚Üï</span>`;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            // Create data rows
            datasets.frames.combinedData.forEach(row => {
                const tr = document.createElement('tr');
                
                // Apply background color based on model type
                if (row[0] && row[0].includes('8B')) {
                    tr.style.backgroundColor = '#fdf2f8'; // Light pink for LLaMA 8B
                } else if (row[0] && row[0].includes('70B')) {
                    tr.style.backgroundColor = '#f0fdfa'; // Light teal for LLaMA 70B
                }
                
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    
                    if (index === 0) {
                        // Model label
                        td.className = 'model-label';
                        if (cell && cell.includes('8B')) {
                            td.className += ' llama8b-label';
                        } else if (cell && cell.includes('70B')) {
                            td.className += ' llama70b-label';
                        }
                        td.textContent = cell || "";
                    } else if (index === 1) {
                        // Config label
                        td.className = 'config-cell';
                        td.textContent = cell || "";
                    } else if (index === 2) {
                        // Top K
                        td.className = 'topk-cell';
                        td.textContent = cell || "";
                    } else {
                        // Value cell
                        td.className = 'value-cell';
                        const headerName = combinedHeaders[index];
                        
                        // Format numeric values
                        if (cell && !isNaN(parseFloat(cell))) {
                            const value = parseFloat(cell);
                            if (headerName && headerName.includes('Accuracy') || headerName.includes('Recall')) {
                                td.textContent = (value * 100).toFixed(1) + '%';
                            } else if (headerName && headerName.includes('Latency') || headerName.includes('Energy')) {
                                td.textContent = value.toFixed(3);
                            } else {
                                td.textContent = value.toFixed(2);
                            }
                        } else {
                            td.textContent = cell || "";
                        }
                    }
                    
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });
        }

        function sortTableFrames(columnIndex) {
            datasets.frames.combinedData.sort((a, b) => {
                let aVal = a[columnIndex];
                let bVal = b[columnIndex];
                
                if (typeof aVal === 'string' && !isNaN(parseFloat(aVal))) {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                }
                
                if (typeof aVal === 'number' && typeof bVal === 'number') {
                    return bVal - aVal;
                } else {
                    return aVal.toString().localeCompare(bVal.toString());
                }
            });
            
            renderTableFrames();
        }

        function generateSummaryStatsFrames() {
            const stats = calculateSummaryStatsFrames();
            const container = document.getElementById('summaryStatsFrames');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: 200px 1fr 1fr 1fr; gap: 20px; width: 100%;">
                    <div class="summary-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; display: flex; align-items: center; justify-content: center;">
                        <h3 style="margin: 0; font-size: 1.2rem;">üê™ LLaMA 8B</h3>
                    </div>
                    <div class="summary-card">
                        <h3>üéØ Best RAG Accuracy</h3>
                        <div class="summary-value">${(stats.bestAccuracy8B * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <h3>‚ö° Lowest Latency</h3>
                        <div class="summary-value">${stats.lowestLatency8B.toFixed(3)}s</div>
                    </div>
                    <div class="summary-card">
                        <h3>üîã Lowest Energy</h3>
                        <div class="summary-value">${stats.lowestEnergy8B.toFixed(1)}J</div>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; display: flex; align-items: center; justify-content: center;">
                        <h3 style="margin: 0; font-size: 1.2rem;">üê™üê™ LLaMA 70B</h3>
                    </div>
                    <div class="summary-card">
                        <h3>üéØ Best RAG Accuracy</h3>
                        <div class="summary-value">${(stats.bestAccuracy70B * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <h3>‚ö° Lowest Latency</h3>
                        <div class="summary-value">${stats.lowestLatency70B.toFixed(3)}s</div>
                    </div>
                    <div class="summary-card">
                        <h3>üîã Lowest Energy</h3>
                        <div class="summary-value">${stats.lowestEnergy70B.toFixed(1)}J</div>
                    </div>
                </div>
            `;
        }

        function calculateSummaryStatsFrames() {
            const headers = datasets.frames.headers;
            const accuracyIndex = headers.indexOf('Avg. RAG Accuracy');
            const latencyIndex = headers.indexOf('Avg. Gen. Latency (s)');
            const energyIndex = headers.indexOf('Total Avg. Energy per Query (J)');
            
            const stats = {
                bestAccuracy8B: 0,
                bestAccuracy70B: 0,
                lowestLatency8B: Infinity,
                lowestLatency70B: Infinity,
                lowestEnergy8B: Infinity,
                lowestEnergy70B: Infinity
            };
            
            const llama8bData = datasets.frames.allData.filter(row => row[0] === 'LLAMA8B');
            const llama70bData = datasets.frames.allData.filter(row => row[0] === 'LLAMA70B');
            
            llama8bData.forEach(row => {
                const accuracy = parseFloat(row[accuracyIndex]) || 0;
                const latency = parseFloat(row[latencyIndex]) || Infinity;
                const energy = parseFloat(row[energyIndex]) || Infinity;
                
                if (accuracy > stats.bestAccuracy8B) stats.bestAccuracy8B = accuracy;
                if (latency < stats.lowestLatency8B) stats.lowestLatency8B = latency;
                if (energy < stats.lowestEnergy8B) stats.lowestEnergy8B = energy;
            });
            
            llama70bData.forEach(row => {
                const accuracy = parseFloat(row[accuracyIndex]) || 0;
                const latency = parseFloat(row[latencyIndex]) || Infinity;
                const energy = parseFloat(row[energyIndex]) || Infinity;
                
                if (accuracy > stats.bestAccuracy70B) stats.bestAccuracy70B = accuracy;
                if (latency < stats.lowestLatency70B) stats.lowestLatency70B = latency;
                if (energy < stats.lowestEnergy70B) stats.lowestEnergy70B = energy;
            });
            
            return stats;
        }

        function generateBestConfigsFrames() {
            const container = document.getElementById('bestConfigsContainerFrames');
            const bestConfigs = findBestConfigurationsFrames();
            
            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f7fafc;">
                                <th style="padding: 12px; text-align: center;">Metric</th>
                                <th style="padding: 12px; text-align: center; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white;">Best LLaMA 8B</th>
                                <th style="padding: 12px; text-align: center;">Value</th>
                                <th style="padding: 12px; text-align: center; background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white;">Best LLaMA 70B</th>
                                <th style="padding: 12px; text-align: center;">Value</th>
                                <th style="padding: 12px; text-align: center;">Winner</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            Object.entries(bestConfigs).forEach(([metric, data]) => {
                const winner = data.winner === '8B' ? 'üê™ LLaMA 8B' : 'üê™üê™ LLaMA 70B';
                const winnerClass = data.winner === '8B' ? 'llama8b-label' : 'llama70b-label';
                
                html += `
                    <tr>
                        <td style="padding: 12px; font-weight: 600; text-align: center;">${metric}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9em;">${data.config8B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 600;">${data.value8B}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9em;">${data.config70B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 600;">${data.value70B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 700; border-radius: 5px;" class="${winnerClass}">${winner}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function findBestConfigurationsFrames() {
            const headers = datasets.frames.headers;
            const metrics = [
                { name: 'RAG Accuracy', index: headers.indexOf('Avg. RAG Accuracy'), higher: true, format: (v) => (v * 100).toFixed(1) + '%' },
                { name: 'Document Recall', index: headers.indexOf('Retrieved Doc. Recall@K'), higher: true, format: (v) => (v * 100).toFixed(1) + '%' },
                { name: 'Generation Latency', index: headers.indexOf('Avg. Gen. Latency (s)'), higher: false, format: (v) => v.toFixed(3) + 's' },
                { name: 'Total Energy', index: headers.indexOf('Total Avg. Energy per Query (J)'), higher: false, format: (v) => v.toFixed(1) + 'J' },
                { name: 'Throughput', index: headers.indexOf('Throughput (q/s)'), higher: true, format: (v) => v.toFixed(2) + ' q/s' }
            ];
            
            const bestConfigs = {};
            
            const llama8bData = datasets.frames.allData.filter(row => row[0] === 'LLAMA8B');
            const llama70bData = datasets.frames.allData.filter(row => row[0] === 'LLAMA70B');
            
            metrics.forEach(metric => {
                if (metric.index === -1) return;
                
                let best8B = { value: metric.higher ? -Infinity : Infinity, config: '', row: null };
                let best70B = { value: metric.higher ? -Infinity : Infinity, config: '', row: null };
                
                llama8bData.forEach(row => {
                    const value = parseFloat(row[metric.index]);
                    if (!isNaN(value)) {
                        if ((metric.higher && value > best8B.value) || (!metric.higher && value < best8B.value)) {
                            best8B = { value, config: createConfigLabel(row, headers), row };
                        }
                    }
                });
                
                llama70bData.forEach(row => {
                    const value = parseFloat(row[metric.index]);
                    if (!isNaN(value)) {
                        if ((metric.higher && value > best70B.value) || (!metric.higher && value < best70B.value)) {
                            best70B = { value, config: createConfigLabel(row, headers), row };
                        }
                    }
                });
                
                const winner = (metric.higher ? best8B.value > best70B.value : best8B.value < best70B.value) ? '8B' : '70B';
                
                bestConfigs[metric.name] = {
                    config8B: best8B.config + ` (K=${best8B.row[headers.indexOf('Top K')]})`,
                    value8B: metric.format(best8B.value),
                    config70B: best70B.config + ` (K=${best70B.row[headers.indexOf('Top K')]})`,
                    value70B: metric.format(best70B.value),
                    winner
                };
            });
            
            return bestConfigs;
        }

        // Functions for TriviaQA tab (similar structure)
        function populateFiltersTriviaQA() {
            const originalCombinedData = datasets.triviaqa.originalCombinedData;
            const headers = datasets.triviaqa.headers;
            const modelOptions = [...new Set(originalCombinedData.map(row => row[0]))];
            const embeddingOptions = [...new Set(originalCombinedData.map(row => row[1]))];
            const topKOptions = [...new Set(originalCombinedData.map(row => row[2]))].sort((a, b) => parseInt(a) - parseInt(b));
            const arrivalRateIndex = headers.indexOf('Arrival Rate');
            const arrivalRateOptions = arrivalRateIndex !== -1 ? 
                [...new Set(originalCombinedData.map(row => row[arrivalRateIndex + 3]))].sort((a, b) => parseFloat(a) - parseFloat(b)) : [];
            
            populateSelect('modelFilterTriviaQA', modelOptions);
            populateSelect('embeddingFilterTriviaQA', embeddingOptions);
            populateSelect('topKFilterTriviaQA', topKOptions);
            populateSelect('arrivalRateFilterTriviaQA', arrivalRateOptions);
            
            // Add event listeners
            document.getElementById('modelFilterTriviaQA').addEventListener('change', applyFiltersTriviaQA);
            document.getElementById('embeddingFilterTriviaQA').addEventListener('change', applyFiltersTriviaQA);
            document.getElementById('topKFilterTriviaQA').addEventListener('change', applyFiltersTriviaQA);
            document.getElementById('arrivalRateFilterTriviaQA').addEventListener('change', applyFiltersTriviaQA);
        }

        function applyFiltersTriviaQA() {
            const filters = currentFilters.triviaqa;
            filters.model = document.getElementById('modelFilterTriviaQA').value;
            filters.embedding = document.getElementById('embeddingFilterTriviaQA').value;
            filters.topK = document.getElementById('topKFilterTriviaQA').value;
            filters.arrivalRate = document.getElementById('arrivalRateFilterTriviaQA').value;
            
            const headers = datasets.triviaqa.headers;
            const originalCombinedData = datasets.triviaqa.originalCombinedData;
            
            // Filter the data
            datasets.triviaqa.combinedData = originalCombinedData.filter(row => {
                const arrivalRateIndex = headers.indexOf('Arrival Rate');
                const arrivalRate = arrivalRateIndex !== -1 ? row[arrivalRateIndex + 3] : '';
                
                return (
                    (!filters.model || row[0] === filters.model) &&
                    (!filters.embedding || row[1] === filters.embedding) &&
                    (!filters.topK || row[2] === filters.topK) &&
                    (!filters.arrivalRate || arrivalRate === filters.arrivalRate)
                );
            });
            
            // Update summary
            updateFilterSummaryTriviaQA();
            
            // Re-render table
            renderTableTriviaQA();
            
            // Update stats and configs with filtered data
            generateSummaryStatsTriviaQA();
            generateBestConfigsTriviaQA();
        }

        function clearAllFiltersTriviaQA() {
            document.getElementById('modelFilterTriviaQA').value = '';
            document.getElementById('embeddingFilterTriviaQA').value = '';
            document.getElementById('topKFilterTriviaQA').value = '';
            document.getElementById('arrivalRateFilterTriviaQA').value = '';
            
            currentFilters.triviaqa = {
                model: '',
                embedding: '',
                topK: '',
                arrivalRate: ''
            };
            
            datasets.triviaqa.combinedData = [...datasets.triviaqa.originalCombinedData];
            
            updateFilterSummaryTriviaQA();
            renderTableTriviaQA();
            generateSummaryStatsTriviaQA();
            generateBestConfigsTriviaQA();
        }

        function updateFilterSummaryTriviaQA() {
            const summary = document.getElementById('filterSummaryTriviaQA');
            const filters = currentFilters.triviaqa;
            const activeFilters = Object.entries(filters)
                .filter(([key, value]) => value !== '')
                .map(([key, value]) => `${key}: ${value}`);
            
            if (activeFilters.length > 0) {
                summary.style.display = 'block';
                summary.textContent = `Showing ${datasets.triviaqa.combinedData.length} rows filtered by: ${activeFilters.join(', ')}`;
            } else {
                summary.style.display = 'none';
            }
        }

        function renderTableTriviaQA() {
            const table = document.getElementById('comparisonTableTriviaQA');
            const thead = document.getElementById('tableHeadTriviaQA');
            const tbody = document.getElementById('tableBodyTriviaQA');
            
            // Clear existing content
            thead.innerHTML = '';
            tbody.innerHTML = '';
            
            // Create header row
            const headerRow = document.createElement('tr');
            const combinedHeaders = ['Model', 'Embedding', 'Top K', ...datasets.triviaqa.headers];
            
            combinedHeaders.forEach((header, index) => {
                const th = document.createElement('th');
                th.onclick = () => sortTableTriviaQA(index);
                th.innerHTML = `${header} <span class="sort-indicator">‚Üï</span>`;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            
            // Create data rows
            datasets.triviaqa.combinedData.forEach(row => {
                const tr = document.createElement('tr');
                
                // Apply background color based on model type
                if (row[0] && row[0].includes('8B')) {
                    tr.style.backgroundColor = '#fdf2f8'; // Light pink for LLaMA 8B
                } else if (row[0] && row[0].includes('70B')) {
                    tr.style.backgroundColor = '#f0fdfa'; // Light teal for LLaMA 70B
                }
                
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    
                    if (index === 0) {
                        // Model label
                        td.className = 'model-label';
                        if (cell && cell.includes('8B')) {
                            td.className += ' llama8b-label';
                        } else if (cell && cell.includes('70B')) {
                            td.className += ' llama70b-label';
                        }
                        td.textContent = cell || "";
                    } else if (index === 1) {
                        // Config label
                        td.className = 'config-cell';
                        td.textContent = cell || "";
                    } else if (index === 2) {
                        // Top K
                        td.className = 'topk-cell';
                        td.textContent = cell || "";
                    } else {
                        // Value cell
                        td.className = 'value-cell';
                        const headerName = combinedHeaders[index];
                        
                        // Format numeric values
                        if (cell && !isNaN(parseFloat(cell))) {
                            const value = parseFloat(cell);
                            if (headerName && headerName.includes('Accuracy') || headerName.includes('Recall')) {
                                td.textContent = (value * 100).toFixed(1) + '%';
                            } else if (headerName && headerName.includes('Latency') || headerName.includes('Energy')) {
                                td.textContent = value.toFixed(3);
                            } else {
                                td.textContent = value.toFixed(2);
                            }
                        } else {
                            td.textContent = cell || "";
                        }
                    }
                    
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });
        }

        function sortTableTriviaQA(columnIndex) {
            datasets.triviaqa.combinedData.sort((a, b) => {
                let aVal = a[columnIndex];
                let bVal = b[columnIndex];
                
                if (typeof aVal === 'string' && !isNaN(parseFloat(aVal))) {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                }
                
                if (typeof aVal === 'number' && typeof bVal === 'number') {
                    return bVal - aVal;
                } else {
                    return aVal.toString().localeCompare(bVal.toString());
                }
            });
            
            renderTableTriviaQA();
        }

        function generateSummaryStatsTriviaQA() {
            const stats = calculateSummaryStatsTriviaQA();
            const container = document.getElementById('summaryStatsTriviaQA');
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: 200px 1fr 1fr 1fr; gap: 20px; width: 100%;">
                    <div class="summary-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white; display: flex; align-items: center; justify-content: center;">
                        <h3 style="margin: 0; font-size: 1.2rem;">üê™ LLaMA 8B</h3>
                    </div>
                    <div class="summary-card">
                        <h3>üéØ Best RAG Accuracy</h3>
                        <div class="summary-value">${(stats.bestAccuracy8B * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <h3>‚ö° Lowest Latency</h3>
                        <div class="summary-value">${stats.lowestLatency8B.toFixed(3)}s</div>
                    </div>
                    <div class="summary-card">
                        <h3>üîã Lowest Energy</h3>
                        <div class="summary-value">${stats.lowestEnergy8B.toFixed(1)}J</div>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white; display: flex; align-items: center; justify-content: center;">
                        <h3 style="margin: 0; font-size: 1.2rem;">üê™üê™ LLaMA 70B</h3>
                    </div>
                    <div class="summary-card">
                        <h3>üéØ Best RAG Accuracy</h3>
                        <div class="summary-value">${(stats.bestAccuracy70B * 100).toFixed(1)}%</div>
                    </div>
                    <div class="summary-card">
                        <h3>‚ö° Lowest Latency</h3>
                        <div class="summary-value">${stats.lowestLatency70B.toFixed(3)}s</div>
                    </div>
                    <div class="summary-card">
                        <h3>üîã Lowest Energy</h3>
                        <div class="summary-value">${stats.lowestEnergy70B.toFixed(1)}J</div>
                    </div>
                </div>
            `;
        }

        function calculateSummaryStatsTriviaQA() {
            const headers = datasets.triviaqa.headers;
            const accuracyIndex = headers.indexOf('Avg. RAG Accuracy');
            const latencyIndex = headers.indexOf('Avg. Gen. Latency (s)');
            const energyIndex = headers.indexOf('Total Avg. Energy per Query (J)');
            
            const stats = {
                bestAccuracy8B: 0,
                bestAccuracy70B: 0,
                lowestLatency8B: Infinity,
                lowestLatency70B: Infinity,
                lowestEnergy8B: Infinity,
                lowestEnergy70B: Infinity
            };
            
            const llama8bData = datasets.triviaqa.allData.filter(row => row[0] === 'LLAMA8B');
            const llama70bData = datasets.triviaqa.allData.filter(row => row[0] === 'LLAMA70B');
            
            llama8bData.forEach(row => {
                const accuracy = parseFloat(row[accuracyIndex]) || 0;
                const latency = parseFloat(row[latencyIndex]) || Infinity;
                const energy = parseFloat(row[energyIndex]) || Infinity;
                
                if (accuracy > stats.bestAccuracy8B) stats.bestAccuracy8B = accuracy;
                if (latency < stats.lowestLatency8B) stats.lowestLatency8B = latency;
                if (energy < stats.lowestEnergy8B) stats.lowestEnergy8B = energy;
            });
            
            llama70bData.forEach(row => {
                const accuracy = parseFloat(row[accuracyIndex]) || 0;
                const latency = parseFloat(row[latencyIndex]) || Infinity;
                const energy = parseFloat(row[energyIndex]) || Infinity;
                
                if (accuracy > stats.bestAccuracy70B) stats.bestAccuracy70B = accuracy;
                if (latency < stats.lowestLatency70B) stats.lowestLatency70B = latency;
                if (energy < stats.lowestEnergy70B) stats.lowestEnergy70B = energy;
            });
            
            return stats;
        }

        function generateBestConfigsTriviaQA() {
            const container = document.getElementById('bestConfigsContainerTriviaQA');
            const bestConfigs = findBestConfigurationsTriviaQA();
            
            let html = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f7fafc;">
                                <th style="padding: 12px; text-align: center;">Metric</th>
                                <th style="padding: 12px; text-align: center; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); color: white;">Best LLaMA 8B</th>
                                <th style="padding: 12px; text-align: center;">Value</th>
                                <th style="padding: 12px; text-align: center; background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); color: white;">Best LLaMA 70B</th>
                                <th style="padding: 12px; text-align: center;">Value</th>
                                <th style="padding: 12px; text-align: center;">Winner</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            Object.entries(bestConfigs).forEach(([metric, data]) => {
                const winner = data.winner === '8B' ? 'üê™ LLaMA 8B' : 'üê™üê™ LLaMA 70B';
                const winnerClass = data.winner === '8B' ? 'llama8b-label' : 'llama70b-label';
                
                html += `
                    <tr>
                        <td style="padding: 12px; font-weight: 600; text-align: center;">${metric}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9em;">${data.config8B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 600;">${data.value8B}</td>
                        <td style="padding: 12px; text-align: center; font-size: 0.9em;">${data.config70B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 600;">${data.value70B}</td>
                        <td style="padding: 12px; text-align: center; font-weight: 700; border-radius: 5px;" class="${winnerClass}">${winner}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function findBestConfigurationsTriviaQA() {
            const headers = datasets.triviaqa.headers;
            const metrics = [
                { name: 'RAG Accuracy', index: headers.indexOf('Avg. RAG Accuracy'), higher: true, format: (v) => (v * 100).toFixed(1) + '%' },
                { name: 'Document Recall', index: headers.indexOf('Retrieved Doc. Recall@K'), higher: true, format: (v) => (v * 100).toFixed(1) + '%' },
                { name: 'Generation Latency', index: headers.indexOf('Avg. Gen. Latency (s)'), higher: false, format: (v) => v.toFixed(3) + 's' },
                { name: 'Total Energy', index: headers.indexOf('Total Avg. Energy per Query (J)'), higher: false, format: (v) => v.toFixed(1) + 'J' },
                { name: 'Throughput', index: headers.indexOf('Throughput (q/s)'), higher: true, format: (v) => v.toFixed(2) + ' q/s' }
            ];
            
            const bestConfigs = {};
            
            const llama8bData = datasets.triviaqa.allData.filter(row => row[0] === 'LLAMA8B');
            const llama70bData = datasets.triviaqa.allData.filter(row => row[0] === 'LLAMA70B');
            
            metrics.forEach(metric => {
                if (metric.index === -1) return;
                
                let best8B = { value: metric.higher ? -Infinity : Infinity, config: '', row: null };
                let best70B = { value: metric.higher ? -Infinity : Infinity, config: '', row: null };
                
                llama8bData.forEach(row => {
                    const value = parseFloat(row[metric.index]);
                    if (!isNaN(value)) {
                        if ((metric.higher && value > best8B.value) || (!metric.higher && value < best8B.value)) {
                            best8B = { value, config: createConfigLabel(row, headers), row };
                        }
                    }
                });
                
                llama70bData.forEach(row => {
                    const value = parseFloat(row[metric.index]);
                    if (!isNaN(value)) {
                        if ((metric.higher && value > best70B.value) || (!metric.higher && value < best70B.value)) {
                            best70B = { value, config: createConfigLabel(row, headers), row };
                        }
                    }
                });
                
                const winner = (metric.higher ? best8B.value > best70B.value : best8B.value < best70B.value) ? '8B' : '70B';
                
                bestConfigs[metric.name] = {
                    config8B: best8B.config + ` (K=${best8B.row[headers.indexOf('Top K')]})`,
                    value8B: metric.format(best8B.value),
                    config70B: best70B.config + ` (K=${best70B.row[headers.indexOf('Top K')]})`,
                    value70B: metric.format(best70B.value),
                    winner
                };
            });
            
            return bestConfigs;
        }

        // Initialize the dashboard
        loadFinanceBenchData();
    </script>
</body>
</html> 
